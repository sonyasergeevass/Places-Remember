{% extends 'main.html' %}
{% load static %}
{% load socialaccount %}

{% block title %}Add memories{% endblock %}

{% block content %}
<div class="top-panel">
    <div class="row">
        <div class="col-md-6">
            <h3>Places Remember</h3>
        </div>
        <div class="col-md-6 text-md-end">
            <div class="user-info">
                <img src="{{ vk_data.photo_big }}">
                <span>{{ user.first_name }}</span>
                <a class="btn btn-primary" href="{% url 'logout' %}">Sign
                    out</a>
            </div>
        </div>
    </div>
</div>
<div class="container container3">
    <div class="map-container">
        <div id="map"></div>
    </div>
    <div class="form-container">
        <form action="{% url 'add_mem' %}" method="POST">
            {% csrf_token %}
            <input id="latitude" name="latitude" required type="hidden"
                   value="">
            <input id="longitude" name="longitude" required type="hidden"
                   value="">
            <input name="title" placeholder="Name of the memory" required
                   type="text">
            <textarea name="description"
                      placeholder="Description of the memory"
                      required></textarea>
            <button class="btn btn-primary" style="width: 130px; height: 36px; margin-left: 115px"
                    type="submit" onclick="return validateCoordinates();">Save
                memory
            </button>
        </form>
    </div>
</div>
<script type="text/javascript">
    ymaps.ready(init);
    function init(){
        var myMap = new ymaps.Map("map", {
            center: [55.76, 37.64],
            zoom: 10
        });

        var placemark = null;

        myMap.events.add('click', function (e) {
            var coords = e.get('coords');
            if (placemark) {
                myMap.geoObjects.remove(placemark);
            }
            placemark = new ymaps.Placemark(coords);
            myMap.geoObjects.add(placemark);
            document.getElementById('latitude').value = coords[0];
            document.getElementById('longitude').value = coords[1];
        });
    }

    function validateCoordinates() {
        var latitude = document.getElementById('latitude').value;
        var longitude = document.getElementById('longitude').value;
        if (latitude === '' || longitude === '') {
            alert("Please set a marker on the map.");
            return false;
        }
        return true;
    }
</script>
{% endblock %}